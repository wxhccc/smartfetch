!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("axios")):"function"==typeof define&&define.amd?define(["exports","axios"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).Smartfetch={},e.axios)}(this,(function(e,t){"use strict";function n(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var r=n(t);function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function s(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){u(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function i(e){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function c(e,t,n,r,o,s,i){try{var c=e[s](i),a=c.value}catch(e){return void n(e)}c.done?t(a):Promise.resolve(a).then(r,o)}function a(e){return function(){var t=this,n=arguments;return new Promise((function(r,o){var s=e.apply(t,n);function i(e){c(s,r,o,i,a,"next",e)}function a(e){c(s,r,o,i,a,"throw",e)}i(void 0)}))}}function u(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var f=Object.prototype,l=f.hasOwnProperty,p=f.toString;function h(e){return y.apply(this,arguments)}function y(){return(y=a(regeneratorRuntime.mark((function e(t){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,t;case 3:return n=e.sent,e.abrupt("return",[null,n]);case 7:return e.prev=7,e.t0=e.catch(0),e.abrupt("return",[e.t0,void 0]);case 10:case"end":return e.stop()}}),e,null,[[0,7]])})))).apply(this,arguments)}var d={};var g=Object.defineProperty((function(e,t){var n,r,o=function(e){return e?e._isVue||e.$&&e.$.vnode?"vue":"setState"in e?"react":"unknown":"unknown"}(this),c="unknown"!==o,a=c?this:d,f="react"===o?"state":"",y=f?a[f]:a,g="boolean"==typeof t?{wrap:t}:s({},t),b=g.wrap,C=g.lock,v=g.syncRefHandle,O=g.manualUnlock,j=void 0,m=void 0,w=[],k=!1,_=!1,x=function(e,t){return!!e&&l.call(e,t)},S=function(e){return"Object"===(t=e,(n=p.call(t).match(/^\[object (.*)\]$/))?n[1]:"");var t,n},E=function(e){w.length?c?function(e,t,n){if("vue"!==o||!a.$set||x(e,t[0])){for(var r=a.$set,i=void 0===r?function(e,t,n){e[t]=n}:r,c="react"===o,f=c?s({},e):e,l=f,p=!1,h=0;h<t.length;h++){var y=t[h],d=x(l,y);if(h===t.length-1){var g="boolean"==typeof l[y];(p=!d||g)&&i(l,y,n)}else{if(!d&&i(l,y,{}),!S(l[y]))break;c&&(l[y]=s({},l[y])),l=l[y]}}c&&p&&a.setState(u({},t[0],f[t[0]]))}}(y,w,e):d[C]=e:(m&&(m[0][m[1]]=e),j&&j(e))},P=function(){return m?m[0][m[1]]:c||"string"!=typeof C?function(e,t){var n=!1;if(e&&S(e)&&Array.isArray(t)&&t.length)for(var r=e,o=0;o<t.length;o++){var s=t[o];if("object"!==i(r)||!x(r,s))break;r=r[s],o===t.length-1&&(n="boolean"==typeof r&&r)}return n}(y,w):y[C]};if(C){var A=function(e){return Array.isArray(e)&&2===e.length};"string"==typeof C?w=C.split("."):A(C)?m=C:"function"==typeof C&&(j=C,A(v)&&(m=v)),(k=w.length>0||!!m||!!j)&&(_=P())}n="function"==typeof e?_?(r=Promise.resolve(void 0),Object.assign(r,{then:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var o=t[0];return 2===t.length&&"function"==typeof o?o(void 0):r},catch:function(e){return r},finally:function(){return r}})):b?h(e()):e():b?h(e):e;var $=function(){return E(!1)};return Object.defineProperties(n,{__lockValue:{get:P},unlock:{value:$}}),k&&!_&&(E(!0),!O&&n.finally($)),n}),"_checkLockKey",{value:function(e){return d[e]}});const b={credentitals:"same-origin",responseType:"json"},C={json:"json",text:"text",blob:"blob",arraybuffer:"arrayBuffer"};function v(e,t,n){return(t=t instanceof Error?t:new Error).name=e,n&&(t.message=n),t}function O(e,t,n,r={}){const o=e;let s=e.$core,i=e.$curCfg,c=null,a=null;const u={needCodeCheck:!!e.options.responseCheck,silence:!1,...r};let f={};const l=e=>{e&&"string"==typeof e&&o.baseConfigs[e]&&(i=o.baseConfigs[e],!o.useFetch&&(s=o.getAxiosCore(e)))},p=e=>{if(u.needCodeCheck&&!(e=>{let t=!1;const{responseCheck:n}=o.options;return"function"==typeof n?t=n(e):"string"==typeof n&&(t=!!e[n]),t})(e))throw a=e,v("CodeError",void 0,"code checked failed");return e},h=e=>{if("function"==typeof u.failHandler&&u.failHandler(e),u.silence)return[e,void 0];let t="";const{statusMsgs:n,options:{errorHandler:r,codeErrorHandler:s},useFetch:i}=o;if(i&&e instanceof TypeError||"Network Error"===e.message)t="服务器未响应";else if(e instanceof SyntaxError)t="数据解析失败";else if(e instanceof RangeError||e.response){e.response&&(c=e.response);const{status:r}=c;t=r&&n[r]||"请求失败"}return"CodeError"===e.name&&"function"==typeof s?s(a):"function"==typeof r?r(t,e,c||void 0):"function"==typeof alert?alert(t):console.error(e),[e,void 0]};return(e=>{const n=[],a=()=>{(e=>{e.useCore&&"string"==typeof e.useCore&&(l(e.useCore),delete e.useCore)})(e);return g.call(t,(async()=>{try{if(!e||"string"!=typeof e.url)throw v("ConfigError",void 0,"smartfetch: no valid url");const t=await(o.useFetch?(async e=>{const{baseURL:t,headers:n}=i||{};return e.url||(e.url=""),t&&(e.url||"").indexOf("http")<0&&(e.url=t+e.url),n&&(e.headers={...e.headers,...n}),f=Object.assign({},b,e),(e=>{const{responseType:t}=f,n=C[t];return n&&"function"==typeof e[n]?e[n]():void 0})((e=>{c=e;const{validateStatus:t}=o.options;if(t?t(e.status):e.ok)return e;throw new Error(`Request failed with status code ${e.status}`)})(await o.$core(e.url,f)))})(e):(async e=>{const t=await s(e);return c=t,t.data})(e)),r=(e=>{const{dataKey:t}=o.options;return t?e[t]:e})(p(t));if(n.length){return[null,await n.reduce(((e,t)=>e.then(t)),Promise.resolve(r))]}return[null,r]}catch(e){return h(e)}}),{lock:u.lock})},y=r.lock?a():Promise.resolve().then(a),d=Object.assign(y,{done:e=>(n.push(e),d),faile:e=>(u.failHandler=e,y),useCore:e=>(e&&l(e),d),lock:(e,t)=>(u.lock=e,t&&(u.syncRefHandle=t),d),silence:()=>(u.silence=!0,d),notCheckCode:()=>(u.needCodeCheck=!1,d)});return d})(n)}const{hasOwnProperty:j,toString:m}=Object.prototype,w=e=>{const t=m.call(e).match(/^\[object (.*)\]$/);return t?t[1]:""},k=["GET","HEAD","POST","PUT","DELETE","OPTIONS","PATCH"],_={json:"application/json",urlencode:"application/x-www-form-urlencoded",text:"text/plain"};function x(e){const t=[],n=e=>encodeURIComponent(e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]");return Object.keys(e).forEach((r=>{const o=e[r];if(null==o)return;const s=Array.isArray(o)?o:[o];Array.isArray(o)&&(r+="[]"),s.forEach((e=>{e instanceof Date?e=e.toISOString():"Object"===w(e)&&(e=JSON.stringify(e)),t.push(n(r)+"="+n(e))}))})),t.join("&")}function S(e,t,n){const r=function(e,t){if(!t)return e;let n="";if(n=t instanceof URLSearchParams?t.toString():x(t),n){const t=e.indexOf("#");-1!==t&&(e=e.slice(0,t)),e+=(-1===e.indexOf("?")?"?":"&")+n}return e}(e,t);if(e.indexOf("http")>=0)return r;return(n&&n.baseURL?n.baseURL:"")+r}class E{constructor(e){var t;this._fetchEnable=!1,this._useFetch=!0,this._axiosCores=Object.create(null),this._baseCfgs=Object.create(null),this._statusMsgs=Object.create(null),this.$curCfg=Object.create(null),this._options={},this.fetch=(t=this,function(e,n,r,o){const s="string"==typeof e?A(e,n,r):e||{};return O(t,this,s,o)}),this.resetOptions(e),this._fetchCoreChoose(!(!e||!e.forceAxios))}get useFetch(){return this._useFetch}get axiosCores(){return this._axiosCores}get baseConfigs(){return this._baseCfgs}get statusMsgs(){return this._statusMsgs}get options(){return this._options}_fetchCoreChoose(e){this._fetchEnable="function"==typeof fetch,this._ajaxCoreSwitch(e||!this._fetchEnable)}_ajaxCoreSwitch(e){Object.assign(this,{_useFetch:!e,$core:e?r.default:fetch.bind(window||global)})}_fetchCoreSetup(e){const{_axiosCores:t,_baseCfgs:n,_useFetch:o}=this;(Array.isArray(e)?e.length?e:[{key:"default"}]:[{key:"default",...e}]).forEach((e=>{const s=Object.assign({},e),{key:i}=s;i&&(delete s.key,n[i]=s,!o&&(t[i]=r.default.create(e)))})),this.$curCfg=n.default,!o&&(this.$core=t.default)}getAxiosCore(e){return((e,t)=>j.call(e,t))(this._axiosCores,e)?this._axiosCores[e]:this.$core}install(e,t){t&&t instanceof Object&&this.resetOptions(t),"globalProperties"in e.config?e.config.globalProperties.$fetch=this.fetch:e.prototype.$fetch=this.fetch}modifyBaseConfigs(e){"function"==typeof e&&e(this._baseCfgs)}resetOptions(e={},t){(e||"Object"===w(e))&&(this._options=t?e:{...this._options,...e},this._ajaxCoreSwitch(!!e.forceAxios),e.baseConfigs&&this._fetchCoreSetup(e.baseConfigs))}}const P=new E,A=function(e){let t="default";const{useFetch:n,options:r,baseConfigs:o}=e;function s(e,s={},i="GET",c){i=k.includes(i)?i:"GET";const a=["GET","HEAD"].includes(i),{baseData:u}=r,f="function"==typeof u?u(t):u,l=s instanceof FormData,p={...f,...l?{}:s},{returnLink:h,enctype:y}={returnLink:!1,enctype:"json",...c};if(h&&a){return S(e,p,o&&o[t]?o[t]:void 0)}const d={url:e,method:n?i:i.toLowerCase(),useCore:t};return"none"!==y&&(d.headers={"Content-Type":_[y]?_[y]:_.json}),n&&"json"!==y&&(d.responseType="blob"),Object.keys(p).length?a?(n?d.url+=`?${x(p)}`:d.params=s,d):(f&&l&&function(e,t){if(t&&e instanceof FormData)for(const n in t){if(e.has(n))continue;const r=t[n];["Number","String","Date"].indexOf(w(r))>-1?e.append(n,"Date"===w(r)?r.toISOString():String(r)):x(r).split("&").map((e=>e.split("="))).forEach((([t,n])=>t&&n&&e.append(t,n)))}}(s,p),n?d.body=l?s:"json"===y?JSON.stringify(s):x(s):d.data=l||"json"===y?s:x(s),d):d}return function(...e){t="default";const n=e[0];return"string"==typeof n?s(...e):n&&"string"==typeof n.useCore&&o[n.useCore]?(t=n.useCore,s):()=>{}}}(P);e.SmartFetch=E,e.default=P,e.request=A,e.wp=g,Object.defineProperty(e,"__esModule",{value:!0})}));
